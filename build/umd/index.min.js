!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e(t.ReactTransitionHandler={},t.React)}(this,function(t,e){"use strict";var n="default"in e?e.default:e,o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},c={start:"start",progress:"progress",idle:"idle"},a={componentWillLeave:"componentWillLeave",componentWillEnter:"componentWillEnter",componentDidLeave:"componentDidLeave",componentDidEnter:"componentDidEnter"},p={wrapper:{height:"100%",width:"100%",position:"relative",top:0,left:0,overflow:"hidden"}},h=function(t){function e(r){o(this,e);var i=s(this,t.call(this,r));return i.state={current:n.Children.only(r.children),next:null},i.curretElementFN=function(t){return i.curretElement=t},i.nextElementFN=function(t){return i.nextElement=t},i.currentSwitchFN=function(t){return i.currentSwitch=t},i.nextSwitchFN=function(t){return i.nextSwitch=t},i._transitionStatus=c.idle,i}return i(e,t),e.prototype.componentWillReceiveProps=function(t){var e=n.Children.only(t.children),o=n.Children.only(this.props.children);null!==e&&e.key!==o.key&&(this._transitionStatus=c.start,this.setState({next:e,current:o}))},e.prototype.shouldComponentUpdate=function(){return this._transitionStatus===c.start||this._transitionStatus===c.progress},e.prototype.componentDidUpdate=function(){var t=this;if(this._transitionStatus===c.start){this._transitionStatus=c.progress,"function"==typeof this.currentSwitch._onlifeCycle&&this.currentSwitch._onlifeCycle(a.componentWillLeave),"function"==typeof this.nextSwitch._onlifeCycle&&this.nextSwitch._onlifeCycle(a.componentWillEnter),this._callEvents("onLeaving",this.currentSwitch,this.curretElement),this._callEvents("onEntering",this.nextSwitch,this.nextElement),this.nextElement.scrollTop,this.curretElement.className=this.curretElement.className.replace("leave-from","leave-to"),this.nextElement.className=this.nextElement.className.replace("enter-from","enter-to");var e={componentDidLeave:c.progress,componentDidEnter:c.progress},n=function(n){delete e[n],0===Object.keys(e).length&&t.setState({current:t.state.next,next:null},function(){t._transitionStatus=c.idle})},o=this._transitionFN(this.currentSwitch,a.componentDidLeave,n,this.curretElement);this.curretElement.addEventListener("transitionend",o,!1);var r=this._transitionFN(this.nextSwitch,a.componentDidEnter,n,this.nextElement);this.nextElement.addEventListener("transitionend",r,!1)}},e.prototype._callEvents=function(t,e,n){"function"==typeof e._getRef?this.props[t](e._getRef()||n):this.props[t](n)},e.prototype._transitionFN=function(t,e,n,o){var r=this;return function i(s){s.preventDefault(),o===s.target&&("function"==typeof t._onlifeCycle&&t._onlifeCycle(e),e===a.componentDidLeave&&r._callEvents("onLeave",t,o),e===a.componentDidEnter&&r._callEvents("onEnter",t,o),s.target.removeEventListener("transitionend",i,!1),n(e))}},e.prototype._getDir=function(){var t=this.state,e=t.current,n=t.next,o=0;if(null!==n&&n.key){var r=e.key.split("."),i=n.key.split("."),s=r.findIndex(function(t,e){return i[e]!==t});o=i[s]>r[s]?1:-1}return o},e.prototype.render=function(){var t=this.state,e=t.current,o=t.next,i=this.currentSwitch&&this.currentSwitch._getClassName?this.currentSwitch._getClassName()||this.props.className:this.props.className,s=null===o?i:i+" "+i+"-leave-from",c=this.props.classNameWrapper?r({},this.props.style):r({},p.wrapper,this.props.style),a=this._getDir(),h=null!==o?"start":"end";return n.createElement("div",{className:this.props.classNameWrapper,style:c},n.createElement("span",{"data-transition":h,"data-dir":a,key:e.key,ref:this.curretElementFN,className:s},n.cloneElement(e,{ref:this.currentSwitchFN})),null!==o&&n.createElement("span",{"data-transition":h,"data-dir":a,key:o.key,ref:this.nextElementFN,className:i+" "+i+"-enter-from"},n.cloneElement(o,{ref:this.nextSwitchFN})))},e}(n.Component);h.defaultProps={onEntering:function(){},onLeaving:function(){},onEnter:function(){},onLeave:function(){}};var l=-1,u=function(t){function e(r){o(this,e);var i=s(this,t.call(this,r));return i._length=n.Children.toArray(r.children).length,i._refComponentFN=function(t){return i._refComponent=t},i._updateTags(),i._history={push:i._push.bind(i),goForward:i._goForward.bind(i),goBack:i._goBack.bind(i)},i}return i(e,t),e.create=function(t){return{key:0,id:t||++l,dir:0}},e.getKey=function(){return[].concat(Array.prototype.slice.call(arguments)).reduce(function(t,e){var n=e.key;return t.concat(n)},[]).join(".")},e.prototype.componentDidMount=function(){this.props.onHistory(this._history),this.props.onEnter(this._refComponent)},e.prototype.shouldComponentUpdate=function(t){return t.switchState.key!==this.props.switchState.key||t.children!==this.props.children},e.prototype.componentWillUnmount=function(){this._callback&&this._callback(this._refComponent),this.props.onLeave(this._refComponent)},e.prototype._push=function(t,e){"string"==typeof t?this._pushToTag(t,e):"number"==typeof t?this._pushToID(t,e):console.error("Must be a number or a string")},e.prototype._pushToTag=function(t,e){void 0!==this._childrenTags[t]?this._pushToID(this._childrenTags[t],e):console.error("Tag does not exist: "+t)},e.prototype._pushToID=function(t,e){if(t>=0&&t<this._length){var n=this.props.switchState.key-t<0?1:-1;this._onSwitchChange(t,n,e)}else console.error("VALUE OUT OF RANGE")},e.prototype._goBack=function(t){var e=this.props.switchState.key-1,n=e>=0?e:this._length-1;this._onSwitchChange(n,-1,t)},e.prototype._goForward=function(t){var e=this.props.switchState.key+1,n=e<this._length?e:0;this._onSwitchChange(n,1,t)},e.prototype._onSwitchChange=function(t,e,n){this._callback=n,this.props.onChange(r({},this.props.switchState,{key:t,dir:e}))},e.prototype._onlifeCycle=function(t){if(this._refComponent&&null!==this._refComponent)if(this._refComponent._onlifeCycle)this._refComponent._onlifeCycle(t);else{var e="function"==typeof this._refComponent.getWrappedInstance?this._refComponent.getWrappedInstance():this._refComponent;e[t]&&e[t]()}},e.prototype._getRef=function(){return this._isSwitchComponent()&&"function"==typeof this._refComponent._getRef?this._refComponent._getRef():this._refComponent},e.prototype._getDir=function(){return this._isSwitchComponent()?this._refComponent._getDir():this.props.switchState.dir},e.prototype._getClassName=function(){return this._isSwitchComponent()?this._refComponent._getClassName()||this.props.className:this.props.className},e.prototype._isSwitchComponent=function(){return this._refComponent&&null!==this._refComponent&&this._refComponent instanceof e},e.prototype._updateTags=function(){var t=this;this._childrenTags={},n.Children.forEach(this.props.children,function(e,n){e.props.tag&&(t._childrenTags[e.props.tag]=n)})},e.prototype._isStateless=function(t){var e=t.type;return"string"!=typeof e&&!e.prototype.render},e.prototype.render=function(){var t=this.props,e=t.switchState,o=t.children,i=n.Children.toArray(o)[e.key];return n.isValidElement(i)?this._isStateless(i)?i:n.cloneElement(i,{ref:this._refComponentFN,history:r({},this._history)}):null},e}(e.Component);u.defaultProps={onHistory:function(){},onChange:function(){},onEnter:function(){},onLeave:function(){}},t.TransitionReplace=h,t.Switch=u,Object.defineProperty(t,"__esModule",{value:!0})});
